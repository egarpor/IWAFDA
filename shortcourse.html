<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Short Course</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">IWAFDA 2017</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="plenary.html">Plenary Talk</a>
</li>
<li>
  <a href="shortcourse.html">Short Course</a>
</li>
<li>
  <a href="data.html">Data and Code</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="http://github.com/jeff-goldsmith/IWAFDA">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Short Course</h1>

</div>


<p>This page contains a combination of traditional lecture materials (slides) and code demonstrating the relevant methods. The short course will proceed by working through both. We will use several recent packages in our examples; see the <a href="./About.html">About</a> page for information about the package versions.</p>
<pre class="r"><code>library(tidyverse)
## Warning: package &#39;tidyverse&#39; was built under R version 3.2.5
## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: tidyr
## Loading tidyverse: readr
## Loading tidyverse: purrr
## Loading tidyverse: dplyr
## Warning: package &#39;ggplot2&#39; was built under R version 3.2.5
## Warning: package &#39;tibble&#39; was built under R version 3.2.5
## Warning: package &#39;tidyr&#39; was built under R version 3.2.5
## Warning: package &#39;purrr&#39; was built under R version 3.2.5
## Warning: package &#39;dplyr&#39; was built under R version 3.2.5
## Conflicts with tidy packages ----------------------------------------------
## filter(): dplyr, stats
## lag():    dplyr, stats
library(grpreg)
## Warning: package &#39;grpreg&#39; was built under R version 3.2.5
## Loading required package: Matrix
## 
## Attaching package: &#39;Matrix&#39;
## The following object is masked from &#39;package:tidyr&#39;:
## 
##     expand
## 
## Attaching package: &#39;grpreg&#39;
## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select
library(splines)
library(refund)
## Warning: package &#39;refund&#39; was built under R version 3.2.5
library(refund.shiny)
## Warning: package &#39;refund.shiny&#39; was built under R version 3.2.5</code></pre>
<div id="overview-of-variable-selection" class="section level2">
<h2>Overview of variable selection</h2>
<div id="methods-for-variable-selection" class="section level3">
<h3>Methods for variable selection</h3>
<p>(placeholder for slides talking about penalization, group penalization, and bayesian variable selection methods)</p>
</div>
<div id="practical-examples" class="section level3">
<h3>Practical examples</h3>
<p>(code and text for group penalization, especially MCP)</p>
</div>
</div>
<div id="scalar-on-function-regression" class="section level2">
<h2>Scalar-on-function regression</h2>
<p>In this section weâ€™ll use the <a href="./Data.html">DTI dataset</a> to motivate the scalar-on-function regression model and variable selection in this context. Our main outcome of interest is multiple sclerosis case status, and the possible predictors are tract profiles from several major white matter structures. Below we plot profiles for one tract colored by MS case status.</p>
<pre class="r"><code>load(&quot;./DataCode/DTI.RDA&quot;)

as_refundObj(CCA_ani) %&gt;% 
    left_join(dplyr::select(outcome_data, id, case)) %&gt;%
    ggplot(aes(x = index, y = value, group = id, color = case)) + geom_path(alpha = .5)
## Joining, by = &quot;id&quot;</code></pre>
<p><img src="shortcourse_files/figure-html/DTI_explore-1.png" width="672" /></p>
<div id="methods-for-variable-selection-1" class="section level3">
<h3>Methods for variable selection</h3>
<p>Slides below review scalar-on-function regression and introduce the ideas for variable selection in this context.</p>
<p>(placeholder for slides: review sofr using fpca, splines; variable selection using group penalties; extensions to generalized sofr; discuss challenges, including sparse or incomplete data, smoothness constraints, and scaling)</p>
</div>
<div id="practical-example" class="section level3">
<h3>Practical example</h3>
<p>Some DTI profiles are incomplete; we can use FPCA to obtain estimates over a complete domain.</p>
<pre class="r"><code>fpca_ex = fpca.sc(CSTL_ani)

bind_rows(as_refundObj(fpca_ex$Y) %&gt;% mutate(type = &quot;Observed&quot;),
                    as_refundObj(fpca_ex$Yhat) %&gt;% mutate(type = &quot;Fitted&quot;)) %&gt;%
    ggplot(aes(x = index, y = value, group = id)) + geom_path(alpha = .5) +
        facet_grid(~type)</code></pre>
<p><img src="shortcourse_files/figure-html/DTI_sofr_varselect-1.png" width="672" /></p>
<p>(Incidentally, the <code>refund.shiny</code> package has helpful tools for visualizing the results of an FPCA analysis).</p>
<pre class="r"><code>plot_shiny(fpca_ex)</code></pre>
<p>Several steps are needed to organize the functional predictors to fit the scalar-on-function regression with variable selection. In particular, for this dataset we use FPCA on each predictor; scale the resulting reconstructions; and combine with a spline basis. The code below implements these steps and produces a list containing the result for each predictor.</p>
<pre class="r"><code>predictor_names = paste(rep(c(&quot;CSTR&quot;, &quot;CSTL&quot;, &quot;CCA&quot;, &quot;OPRL&quot;, &quot;OPRR&quot;), each = 6), 
                                    rep(c(&quot;ani&quot;, &quot;l0&quot;, &quot;lt&quot;, &quot;md&quot;, &quot;mtr&quot;, &quot;t2&quot;), 5), 
                                    sep = &quot;_&quot;)

preprocess_fd_for_sofr = function(data_matrix){
    
    index = seq(0, 1, length = dim(data_matrix)[2])
    basis = splines::bs(index, df = 10, intercept = TRUE)
    int_weights = rep(1 / dim(data_matrix)[2], dim(data_matrix)[2])

    fitted_vals = fpca.sc(data_matrix, npc = 10)$Yhat
    scaled_fv = scale(fitted_vals)
    
    design_mat = scaled_fv %*% diag(int_weights) %*% basis
}

processed_predictors = lapply(predictor_names, function(u) {
        data_mat_cur = get(u)
        preprocess_fd_for_sofr(data_mat_cur)
    })</code></pre>
<p>Given the processed predictors, we construct the design matrix and fit the model using the group variable selection illustrated previously.</p>
<pre class="r"><code>y = outcome_data$case
X = do.call(cbind, processed_predictors)
group = rep(1:30, each = 10)

sofr_fit = grpreg(X = X, y = y, group = group, family = &quot;binomial&quot;, penalty = &quot;grLasso&quot;)</code></pre>
</div>
<div id="try-it-yourself" class="section level3">
<h3>Try it yourself!</h3>
<p>(some intro to the sugar data)</p>
</div>
</div>
<div id="function-on-scalar-regression" class="section level2">
<h2>Function-on-scalar regression</h2>
<p>In this section weâ€™ll use the <a href="./Data.html">Activity data</a> to motivate the function-on-scalar regression model and variable selection in this context. Our main outcome of interest is the observed physical activity profile, with predictors including age, sex, and season. Below we plot activity profiles colored by sex.</p>
<div id="methods-for-variable-selection-2" class="section level3">
<h3>Methods for variable selection</h3>
<p>Slides below review function-on-scalar regression and introduce the ideas for variable selection in this context.</p>
<p>(placeholder for slides: review fosr using splines; variable selection using group penalties; correlated errors (GLS or Bayes methods); discuss challenges, including sparse or incomplete data, smoothness constraints, and scaling)</p>
</div>
<div id="practical-example-1" class="section level3">
<h3>Practical example</h3>
<p>(code and text for OLS-based fosr in the accelerometer example; include Yakuanâ€™s function and results)</p>
</div>
<div id="try-it-yourself-1" class="section level3">
<h3>Try it yourself!</h3>
<p>Using the DTI data with several predictors.</p>
</div>
</div>
<div id="other-topics" class="section level2">
<h2>Other topics</h2>
<p>Time permitting? VBVS in concurrent model. Prediction more generally (ensemble prediction)</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
